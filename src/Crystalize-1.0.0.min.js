(function () { var rootWin = this; var runonce = false; this.Crystalize = { script: {}, result: [], debug: {}, conf: function () { return { all: internal.globalSettings, api: app._api } }, all: function (e) { $.extend(internal.globalSettings, e) }, ver: function () { return internal.CURRENT_VERSION }, _api: {}, make: function () { return new internal.ScenarioObject }, dom: function (e) { return internal.createNewElement(e) }, stat: function () { return { connection: internal.conn } }, reset: function (e) { if (typeof e === "function") { e() } app.result = []; internal = new InternalFactory(this); app._api = (new internal.CreateAPI).api; app.result = [] }, createRequestObject: function (e) { var t = function (e, t) { internal.conn = false; e(t) }; internal.globalSettings.e_("staring to process request to be made", internal.globalSettings._printStackTrace(), this); var n = internal.getAttr(e, app._api.xstal_runonload); var r = internal.QueryDom("*", e); var i = { async: internal.getAttr(e, app._api.xstal_isasync), url: internal.getAttr(e, app._api.xstal_add), data: { request: [internal.getAttr(e, app._api.xstal_function), r] }, contentType: internal.globalSettings.contentType, dataType: internal.globalSettings.dataType, type: internal.globalSettings.type, timeout: parseInt(internal.getAttr(e, app._api.xstal_timeout), 10), success: function (t, n, r) { internal.globalSettings.wholeInternalHandler(e, "success", t, n, r) }, error: function (t, n, r) { internal.globalSettings.wholeInternalHandler(e, "error", r, n, t) } }; if (internal.globalSettings.forceSynchronousOnAllAjaxCalls === true) { i.async = false } else { if (i.async === "true") { i.async = true } else { i.async = false } } var s = {}; s = new function () { this.async = i.async; this.url = i.url; this.responseTime = i.timeout; this.dataType = i.dataType; this.response = i.success; this.contentType = "text/json"; this.responseText = internal.globalSettings.resposeOfNoRequest }; if (internal.globalSettings.forceMockAllAjaxCalls === true) { internal.globalSettings.e_("system is globaly set to ENFORCE AJAX CALL on all request THROUGH MOCKING FRAMEWORK ", internal.globalSettings._printStackTrace(), this); t(internal.globalSettings.MockingFxMethod, s) } else if (internal.getAttr(e, app._api.xstal_test) === "true") { internal.globalSettings.e_("element is set to test so it will MOCK using the mocking framework", internal.globalSettings._printStackTrace(), this); t(internal.globalSettings.MockingFxMethod, s) } var o = {}; if (internal.globalSettings.dontMakeJQAjaxCall === false) { internal.globalSettings.e_("system is globaly set  connect with server ", internal.globalSettings._printStackTrace(), this); if (internal.getAttr(e, app._api.xstal_mocked) === "false") { internal.globalSettings.e_("and element is asking system to connect to server so IT WILL", internal.globalSettings._printStackTrace(), this); o = internal.globalSettings.xmockajax(i, true) } else { internal.globalSettings.e_("and element is asking system not to connect with server so IT WILL MOCK SERVER", internal.globalSettings._printStackTrace(), this); o = internal.globalSettings.xmockajax(i, false, e, true) } } else { internal.globalSettings.e_("system is globaly NOT TO COMMUNICATE WITH SERVER NOR EVEN MAKE ANY AJAX CALL so it will RETURN prescribed object ", internal.globalSettings._printStackTrace(), this); internal.conn = false; o = { responseText: internal.globalSettings.resposeOfNoRequest } } return { response: o, connection: internal.conn, ranOnLoad: n, assync: i.async, element: e, request: i, settings: app.conf() } }, begin: function (e) { internal.globalSettings.e_("started", internal.globalSettings._printStackTrace(), this); if (internal.executed === true) return; internal.globalSettings.compileAvScr(); internal.executed = true; var t = {}; return function () { internal.globalSettings.e_("processing dom", internal.globalSettings._printStackTrace(), this); $(app._api.xstal_master_class.v).each(function () { t = this; var e = false; if (internal.globalSettings.execAllEventOnLoad === true) { e = true; internal.globalSettings.e_("identified to execute all event on load", internal.globalSettings._printStackTrace(), this) } else if (internal.getAttr(this, app._api.xstal_runonload) === "true") { internal.globalSettings.e_("identified to run on load", internal.globalSettings._printStackTrace(), this); e = true } if (e === true) { app.result.push(app.createRequestObject(this)) } }); internal.globalSettings.e_("complete instanciation of cryatal", internal.globalSettings._printStackTrace(), this); return app.result }() } }; var app = rootWin.Crystalize; var InternalFactory = function (that) { that.app = that.Crystalize; var within = this; this.CreateAPI = function () { this.api = { xstal_group_master: { n: "xstal-group-master", v: "oxstal_group_master" }, xstal_master_class: { n: ".xstal-master", v: ".xstal-master" }, xstal_group: { n: "xstal-group", v: "oxstal_group" }, xstal_ret: { n: "xstal-ret", v: "oxstal_ret=html" }, xstal_isasync: { n: "xstal-isasync", v: "false" }, xstal_add: { n: "xstal-add", v: "/oxstal_add" }, xstal_function: { n: "xstal-function", v: "oxstal_function" }, xstal_event: { n: "xstal-event", v: "none" }, xstal_querySeparator: { n: "=", v: "=" }, xstal_test: { n: "xstal-test", v: "false" }, xstal_group_separator: { n: ",", v: "," }, xstal_pre: { n: "xstal-pre", v: "oxstal_pre" }, xstal_pos: { n: "xstal-pos", v: "oxstal_pos" }, xstal_runonload: { n: "xstal-runonload", v: "false" }, xstal_timeout: { n: "xstal-timeout", v: "2000" }, xstal_ajaxresult: { n: "xstal-ajaxresult", v: "" }, xstal_mocked: { n: "xstal-mocked", v: "false" }, xstal_mocked_prefix: { n: "xstal-mockarg-", v: "" } } }; this.createNewElement = function (e) { var t = "<" + e.type + '  class="' + app._api.xstal_master_class.n.replace(".", "") + '"  '; t += "  " + app._api.xstal_group_master.n + '="' + e.oxstal_group_master + '"  '; t += "  " + app._api.xstal_group.n + '="' + e.oxstal_group + '"  '; t += "  " + app._api.xstal_ret.n + '="' + e.oxstal_ret + '"  '; t += "  " + app._api.xstal_isasync.n + '="' + e.oxstal_isasync + '"  '; t += "  " + app._api.xstal_add.n + '="' + e.oxstal_add + '"  '; t += "  " + app._api.xstal_function.n + '="' + e.oxstal_function + '"  '; t += "  " + app._api.xstal_event.n + '="' + e.oxstal_event + '"  '; t += "  " + app._api.xstal_test.n + '="' + e.oxstal_test + '"  '; t += "  " + app._api.xstal_pre.n + '="' + e.oxstal_pre + '"  '; t += "  " + app._api.xstal_pos.n + '="' + e.oxstal_pos + '"  '; t += "  " + app._api.xstal_runonload.n + '="' + e.oxstal_runonload + '"  '; t += "  " + app._api.xstal_timeout.n + '="' + e.oxstal_timeout + '"  '; t += "   " + app._api.xstal_ajaxresult.n + '="' + e.oxstal_ajaxresult + '"   '; t += "   " + app._api.xstal_mocked.n + '="' + e.xstal_mocked + '"   '; var n = "  >" + e.obody + "</" + e.type + "  >"; return t + " " + n }; this.CURRENT_VERSION = "1.0.0"; this.ScenarioObject = function () { this.type = "div"; this.obody = "body"; this.oxstal_group_master = app._api.xstal_group_master.v; this.oxstal_group = app._api.xstal_group.v; this.oxstal_ret = app._api.xstal_ret.v; this.oxstal_isasync = app._api.xstal_isasync.v; this.oxstal_add = app._api.xstal_add.v; this.oxstal_function = app._api.xstal_function.v; this.oxstal_event = app._api.xstal_event.v; this.oxstal_test = app._api.xstal_test.v; this.oxstal_pre = app._api.xstal_pre.v; this.oxstal_pos = app._api.xstal_pos.v; this.oxstal_runonload = app._api.xstal_runonload.v; this.oxstal_timeout = app._api.xstal_timeout.v; this.oxstal_ajaxresult = app._api.xstal_ajaxresult.v; this.oxstal_mocked = app._api.xstal_mocked.v }; this.mockFunction = function () { }; this.mockFunct = function (e, t, n) { if (e === undefined) { e = {} } if (n !== undefined) { } if (t === undefined) { t = {} } internal.deliverXD({ action: e, trace: n, This: t }) }; this.mockMock = function (e) { conn = true }; this.XDlisteners = [], this.deliverXD = function (e) { if (internal.globalSettings.XDebug.enable === true) { var t = internal.XDlisteners; var n = t.length; if (n > 0) { for (var r in t) { e.time = (new Date).toTimeString(); t[r](e) } } } }; this.globalSettings = { compileAvScr: function (e) { internal.globalSettings.e_("detecting script", internal.globalSettings._printStackTrace(), this); try { if (CRYSTAL_SCRIPT) { if (Object.keys(CRYSTAL_SCRIPT).length !== 0) { app.script = CRYSTAL_SCRIPT; internal.globalSettings.e_("detected crystall script", internal.globalSettings._printStackTrace(), this); try { if (CRYSTAL_MOCKS) { internal.globalSettings.runScript(app.script, true, e); internal.globalSettings.e_("detected crystal mocks", internal.globalSettings._printStackTrace(), this) } } catch (t) { internal.globalSettings.runScript(app.script, false, e) } } } } catch (n) { internal.globalSettings.e_("no config found", internal.globalSettings._printStackTrace(), this) } }, attToEvent: function (e) { var t = internal.getAttr(e, app._api.xstal_event); if (t !== "none") { $(e).on(t, function (t) { internal.globalSettings.e_(internal.getAttr(e, app._api.xstal_event) + " event has been triggered", internal.globalSettings._printStackTrace(), e); t.stopPropagation(); return app.createRequestObject(e) }) } }, runScript: function (e, t, n) { var r = false; if (n !== undefined) { r = true } internal.globalSettings.e_("running script", internal.globalSettings._printStackTrace(), this); for (var i in e) { for (var s in e[i]) { if (s !== "__type__") { if (s === "class") { if (r === true) { if (e[i]["__type__"] + i === n) { internal.globalSettings.e_("making " + e[i]["__type__"] + i + "  the master***", internal.globalSettings._printStackTrace(), this); $(e[i]["__type__"] + i).addClass(e[i][s]) } } else { internal.globalSettings.e_("making " + e[i]["__type__"] + i + "  the master***", internal.globalSettings._printStackTrace(), this); $(e[i]["__type__"] + i).addClass(e[i][s]) } } else { internal.globalSettings.e_("adding attribute " + s + "=" + e[i][s] + " to " + e[i]["__type__"] + i, internal.globalSettings._printStackTrace(), this); internal.globalSettings.addAttr(e[i]["__type__"] + i, s, e[i][s]); if (t === true) { if (s === app._api.xstal_mocked.n) { if (e[i][s] !== app._api.xstal_mocked.v) { var o = e[i][s]; var u = ""; for (var a in CRYSTAL_MOCKS) { if (a === o) { for (var f in CRYSTAL_MOCKS[a]) { u = u + f + "=" + CRYSTAL_MOCKS[a][f] + ";" } } } if (r === true) { if (e[i]["__type__"] + i === n) { internal.globalSettings.addAttr(e[i]["__type__"] + i, app._api.xstal_mocked_prefix.n, u); internal.globalSettings.e_("adding attribute " + app._api.xstal_mocked_prefix.n + "=" + u + " to " + e[i]["__type__"] + i, internal.globalSettings._printStackTrace(), this) } } else { internal.globalSettings.addAttr(e[i]["__type__"] + i, app._api.xstal_mocked_prefix.n, u); internal.globalSettings.e_("adding attribute " + app._api.xstal_mocked_prefix.n + "=" + u + " to " + e[i]["__type__"] + i, internal.globalSettings._printStackTrace(), this) } } } } } } } } internal.globalSettings.e_("attaching events", internal.globalSettings._printStackTrace(), this); for (var i in e) { for (var s in e[i]) { if (s !== "__type__") { if (s === "class") { if (r === true) { if (e[i]["__type__"] + i === n) { internal.globalSettings.e_("making " + e[i]["__type__"] + i + "  the master***", internal.globalSettings._printStackTrace(), this); $(e[i]["__type__"] + i).each(function () { internal.globalSettings.attToEvent(this) }) } } else { internal.globalSettings.e_("making " + e[i]["__type__"] + i + "  the master***", internal.globalSettings._printStackTrace(), this); $(e[i]["__type__"] + i).each(function () { internal.globalSettings.attToEvent(this) }) } } } } } }, XDebug: { enable: true, tell: function (e) { if (typeof e === "function") { internal.XDlisteners.push(e); return true } } }, dontMakeJQAjaxCall: false, forceSynchronousOnAllAjaxCalls: false, forceMockAllAjaxCalls: false, execAllEventOnLoad: false, resposeOfNoRequest: {}, MockingFxMethod: within.mockMock, _printStackTrace: function () { return "" }, e_: function (e, t, n) { within.mockFunct(e, n, t) }, mockLookUpTable: [], setMockUpTable: function (e, t, n) { internal.globalSettings.mockLookUpTable.push({ r: e, n: t, v: n }) }, getMockFromMockUpTable: function () { }, GetMockedDataFromMockTable: function (e) { re = {}; var t = internal.globalSettings.mockLookUpTable; var n = t.length; for (var r = 0; r < n; r++) { if (!$(e).hasClass(t[r].r.replace(".", ""))) { } else if (!$(e).attr("id") === t[r].r.replace("#", "")) { } else { re[t[r].n] = t[r].v } } return re }, getMockedData: function (e) { var t = ""; var n = $(e).attr(app._api.xstal_mocked_prefix.n); if (n === "") { throw "DTO does not exist for master with DTO specified as : " + $(e).attr(app._api.xstal_mocked.n) } var r = n.split(";"); for (var i in r) { if (t === "") { t = {} } var s = r[i].split("="); t[s[0]] = s[1] } return t }, xmockajax: function (e, t, n, r, i) { if (t === true) { internal.globalSettings.e_("ajaxing the server", internal.globalSettings._printStackTrace(), this); return $.ajax(e) } else { internal.globalSettings.e_("mocking the server", internal.globalSettings._printStackTrace(), this); if (i === undefined) { i = internal.globalSettings.getMockedData(n) } if (r === true) { e.success(JSON.stringify(i), "", "") } else { e.error("", "", "") } return { response: JSON.stringify(i) } } }, evalAFunction: function (x, y) { internal.globalSettings.e_("performing eval like :try{" + x + "('" + y + "');", internal.globalSettings._printStackTrace(), this); eval("try{" + x + "('" + y + "');}catch(e){}") }, alertFunction: function (e) { internal.globalSettings.e_({ m: "calling native alert for ", objects: e }, internal.globalSettings._printStackTrace(), this); alert(e) }, confirmFunction: function (e) { internal.globalSettings.e_({ m: "calling native confirm for ", objects: e }, internal.globalSettings._printStackTrace(), this); return confirm(e) }, invokeDomManipFunction: function (e, t, n, r, i) { $(e)[t](n, r); if (i !== undefined) { var s = i.split("="); $(s[0]).addClass(s[1]); if (CRYSTAL_SCRIPT[s[1]] !== null) { internal.globalSettings.compileAvScr("." + s[1]) } } }, wholeInternalHandler: function (e, t, n, r, i) { var s = { status: t, textStatus: r, data: n, JqXHR: i }; var o = internal.getAttr(e, app._api.xstal_ajaxresult); if (o !== "") { var u = o.split(";"); var a = u.length; for (var f = 0; f < a; f++) { var l = u[f]; var c = l.replace("*", ""); var h = c.split(","); var p, d, v, m, g, y = ""; p = n; d = h[0]; v = h[1]; m = h[2]; g = h[3]; y = h[4]; if (l.contains("*")) { internal.globalSettings.internalHandler(n, d, v, m, g, y) } else { if (t === "error") { internal.globalSettings.evalAFunction(l, n) } else { internal.globalSettings.evalAFunction(l, n) } } } } }, internalHandler: function (e, t, n, r, i, s) { if (t !== undefined) { if (t === "alert") { internal.globalSettings.Handlers.alertP(e, n, r, i, s) } else if (t === "confirm") { internal.globalSettings.Handlers.confirmP(e, n, r, i, s) } else if (t === "in") { internal.globalSettings.Handlers.inP(e, n, r, i, s) } } }, Handlers: { alertP: function (e, t, n, r) { if (t === undefined) { internal.globalSettings.alertFunction(e) } else if (t.contains("=")) { var i = t.split("="); var s = $.parseJSON(e); internal.globalSettings.alertFunction(s[i[1]]) } }, confirmP: function (e, t, n, r) { var i = true; if (t !== undefined) { if (t.contains("=")) { var s = t.split("="); var o = $.parseJSON(e); i = internal.globalSettings.confirmFunction(o[s[1]]) } else { i = internal.globalSettings.confirmFunction(e) } } if (i === true) { if (t !== undefined) { internal.globalSettings.evalAFunction(t, e) } } else if (n !== undefined) { internal.globalSettings.evalAFunction(n, e) } }, inP: function (e, t, n, r, i) { if (t !== undefined) { if (n !== undefined) { if (n.contains("=")) { var s = n.split("="); var o = $.parseJSON(e); internal.globalSettings.invokeDomManipFunction(t, s[0], o[s[1]], r, i) } else { internal.globalSettings.invokeDomManipFunction(t, n, e, r, i) } } } } }, addAttr: function (e, t, n) { if (n === undefined) { return $(e).attr(t) } else { $(e).attr(t, n) } }, contentType: "application/x-www-form-urlencoded; charset=UTF-8", dataType: "text", type: "POST" }; this.executed = false; this.conn = true; this.extractDom = function (e, t) { var n = within.getAttr(t, app._api.xstal_ret).split(app._api.xstal_querySeparator.n); var r = {}; if (n[1] !== "attr") { r = $(t)[n[1]]() } else { if (n[2] !== "css") { r = $(t).attr(n[2]) } else { r = $(t).css(n[3]) } } e[n[0]] = r }; this.QueryDom = function (e, t) { var n = {}; $(e).each(function () { if (within.IsInGroup(this, t) === true) { within.extractDom(n, this) } }); return n }; this.IsInGroup = function (e, t, n) { var r = within.getAttr(t, app._api.xstal_group_master); var i = within.getAttr(e, app._api.xstal_group); if (i === undefined) { return false } if (r === undefined) { return false } var s = r.split(app._api.xstal_group_separator.n); var o = i.split(app._api.xstal_group_separator.n); var u = o.length; var a = s.length; for (var f = 0; f < u; f++) { for (var l = 0; l < a; l++) { if (s[l] === o[f]) { return true } } } return false }; this.getAttr = function (e, t) { var n = $(e).attr("data-" + t.n); if (n === undefined || n.trim() === "") { n = $(e).attr(t.n) } if (n === undefined || n.trim() === "") { return t.v } return n } }; var internal = new InternalFactory(rootWin); app._api = (new internal.CreateAPI).api; if (typeof printStackTrace === "function") { internal.globalSettings._printStackTrace = printStackTrace } internal.globalSettings.XDebug.enable = true; internal.globalSettings.XDebug.tell(function (e) { console.log({ message: e.action, trace: e.trace }) }); internal.globalSettings.e_("waiting for dom to be ready", internal.globalSettings._printStackTrace(), this); jQuery.fn.dto$combobox = function (e) { if (e !== undefined) { $(this).html(""); o = JSON.parse(e); for (var t in o) { var n = ""; for (var r in o[t]) { n = n + o[t][r] + "," } var i = n.split(","); $(this).append("<option value='" + i[0] + "'>" + i[1] + "</option>") } } }; $(document).ready(function () { internal.globalSettings.e_("the dom is ready and PROCESS will begin", internal.globalSettings._printStackTrace(), this); rootWin.Crystalize.begin("*") }) }).call(this)